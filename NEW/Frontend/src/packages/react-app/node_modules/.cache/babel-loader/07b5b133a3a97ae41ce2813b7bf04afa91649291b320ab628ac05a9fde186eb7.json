{"ast":null,"code":"import { DEFAULT_SUPPORTED_CHAINS } from '../../../constants';\nimport { subscribeToProviderEvents } from '../../../helpers';\nimport { Event } from '../../../helpers/event';\nimport { getAddNetworkParams } from '../../../helpers/getAddNetworkParams';\nimport { validateArguments } from '../../../helpers/validateArgument';\nimport { DEFAULT_CONFIG } from '../../../model/config/default';\nimport { MetamaskConnector } from './implementations';\nexport class ConnectorController {\n  constructor(connector, config = DEFAULT_CONFIG) {\n    this.connector = connector;\n    this.updated = new Event();\n    this.newBlock = new Event();\n    this.active = false;\n    this.accounts = [];\n    this.errors = [];\n    this._config = Object.assign({}, config);\n    this._connectorUnsubscribe = connector.update.on(({\n      chainId,\n      accounts\n    }) => {\n      this.chainId = chainId;\n      this.accounts = accounts;\n      this.emitUpdate();\n    });\n  }\n  emitUpdate() {\n    this.updated.emit({\n      active: this.active,\n      chainId: this.chainId,\n      accounts: this.accounts,\n      blockNumber: this.blockNumber,\n      errors: this.errors\n    });\n  }\n  updateConfig(config) {\n    this._config = Object.assign(Object.assign({}, this._config), config);\n  }\n  getProvider() {\n    return this.connector.provider;\n  }\n  async activate(connectorActivator = connector => connector.activate()) {\n    await connectorActivator(this.connector);\n    const provider = this.getProvider();\n    if (!provider) {\n      throw new Error('Failed to activate connector');\n    }\n    this.clearSubscriptions = subscribeToProviderEvents(this.connector, ({\n      chainId,\n      accounts\n    }) => {\n      if (chainId !== undefined) {\n        this.chainId = chainId;\n      }\n      if (accounts !== undefined) {\n        this.accounts = accounts;\n      }\n      this.emitUpdate();\n    }, () => {\n      if (this.connector instanceof MetamaskConnector && this._config.noMetamaskDeactivate) {\n        return;\n      }\n      void this.deactivate();\n    });\n    this.blockNumber = await provider.getBlockNumber();\n    this.newBlock.emit(this.blockNumber);\n    this.removeBlockEffect = this.newBlock.addEffect(() => {\n      const listener = blockNumber => {\n        this.blockNumber = blockNumber;\n        this.newBlock.emit(blockNumber);\n        this.emitUpdate();\n      };\n      provider.on('block', listener);\n      return () => {\n        provider.off('block', listener);\n      };\n    });\n    this.active = true;\n    this.emitUpdate();\n  }\n  async deactivate() {\n    var _a, _b, _c;\n    this.active = false;\n    (_a = this.removeBlockEffect) === null || _a === void 0 ? void 0 : _a.call(this);\n    (_b = this.clearSubscriptions) === null || _b === void 0 ? void 0 : _b.call(this);\n    (_c = this._connectorUnsubscribe) === null || _c === void 0 ? void 0 : _c.call(this);\n    await this.connector.deactivate();\n    this.chainId = undefined;\n    this.accounts = [];\n    this.blockNumber = undefined;\n    this.errors = [];\n    this.emitUpdate();\n  }\n  async switchNetwork(chainId) {\n    var _a;\n    const provider = this.getProvider();\n    validateArguments({\n      chainId\n    }, {\n      chainId: 'number'\n    });\n    if (!provider) {\n      throw new Error('Connector not initialized');\n    }\n    try {\n      await provider.send('wallet_switchEthereumChain', [{\n        chainId: `0x${chainId.toString(16)}`\n      }]);\n    } catch (error) {\n      const errChainNotAddedYet = 4902; // Metamask error code\n      if (error.code === errChainNotAddedYet) {\n        const chain = ((_a = this._config.networks) !== null && _a !== void 0 ? _a : DEFAULT_SUPPORTED_CHAINS).find(chain => chain.chainId === chainId);\n        if (!chain) throw new Error(`ChainId \"${chainId}\" not found in config.networks. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`);\n        if (!chain.rpcUrl) throw new Error(`ChainId \"${chainId}\" does not have RPC url configured by default. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`);\n        await provider.send('wallet_addEthereumChain', [getAddNetworkParams(chain)]);\n      } else {\n        throw error;\n      }\n    }\n  }\n  reportError(error) {\n    this.errors.push(error);\n    this.emitUpdate();\n  }\n}","map":{"version":3,"names":["DEFAULT_SUPPORTED_CHAINS","subscribeToProviderEvents","Event","getAddNetworkParams","validateArguments","DEFAULT_CONFIG","MetamaskConnector","ConnectorController","constructor","connector","config","updated","newBlock","active","accounts","errors","_config","Object","assign","_connectorUnsubscribe","update","on","chainId","emitUpdate","emit","blockNumber","updateConfig","getProvider","provider","activate","connectorActivator","Error","clearSubscriptions","undefined","noMetamaskDeactivate","deactivate","getBlockNumber","removeBlockEffect","addEffect","listener","off","_a","call","_b","_c","switchNetwork","send","toString","error","errChainNotAddedYet","code","chain","networks","find","rpcUrl","reportError","push"],"sources":["C:\\Users\\win\\Downloads\\clone res gi\\clone\\my-eth-app\\node_modules\\@usedapp\\core\\src\\providers\\network\\connectors\\connectorController.ts"],"sourcesContent":["import { providers } from 'ethers'\nimport { DEFAULT_SUPPORTED_CHAINS, FullConfig } from '../../../constants'\nimport { subscribeToProviderEvents } from '../../../helpers'\nimport { Event } from '../../../helpers/event'\nimport { getAddNetworkParams } from '../../../helpers/getAddNetworkParams'\nimport { validateArguments } from '../../../helpers/validateArgument'\nimport { DEFAULT_CONFIG } from '../../../model/config/default'\nimport { Connector } from './connector'\nimport { MetamaskConnector } from './implementations'\n\nexport interface ControllerUpdateInfo {\n  active: ConnectorController['active']\n  accounts: ConnectorController['accounts']\n  chainId: ConnectorController['chainId']\n  blockNumber: ConnectorController['blockNumber']\n  errors: ConnectorController['errors']\n}\n\nexport class ConnectorController {\n  readonly updated = new Event<ControllerUpdateInfo>()\n  readonly newBlock = new Event<number>()\n\n  public active = false\n  public accounts: string[] = []\n  public chainId: number | undefined\n  public blockNumber: number | undefined\n  public errors: Error[] = []\n\n  private _config: FullConfig\n  private _connectorUnsubscribe: () => void | undefined\n\n  private emitUpdate() {\n    this.updated.emit({\n      active: this.active,\n      chainId: this.chainId,\n      accounts: this.accounts,\n      blockNumber: this.blockNumber,\n      errors: this.errors,\n    })\n  }\n\n  public updateConfig(config: Partial<FullConfig>) {\n    this._config = {\n      ...this._config,\n      ...config,\n    }\n  }\n\n  private removeBlockEffect?: () => void\n  private clearSubscriptions?: () => void\n\n  constructor(public readonly connector: Connector, config: FullConfig = DEFAULT_CONFIG) {\n    this._config = { ...config }\n    this._connectorUnsubscribe = connector.update.on(({ chainId, accounts }) => {\n      this.chainId = chainId\n      this.accounts = accounts\n      this.emitUpdate()\n    })\n  }\n\n  getProvider(): providers.Web3Provider | providers.JsonRpcProvider | undefined {\n    return this.connector.provider\n  }\n\n  async activate(connectorActivator = (connector: Connector) => connector.activate()) {\n    await connectorActivator(this.connector)\n    const provider = this.getProvider()\n    if (!provider) {\n      throw new Error('Failed to activate connector')\n    }\n\n    this.clearSubscriptions = subscribeToProviderEvents(\n      this.connector,\n      ({ chainId, accounts }) => {\n        if (chainId !== undefined) {\n          this.chainId = chainId\n        }\n        if (accounts !== undefined) {\n          this.accounts = accounts\n        }\n        this.emitUpdate()\n      },\n      () => {\n        if (this.connector instanceof MetamaskConnector && this._config.noMetamaskDeactivate) {\n          return\n        }\n        void this.deactivate()\n      }\n    )\n\n    this.blockNumber = await provider.getBlockNumber()\n    this.newBlock.emit(this.blockNumber)\n    this.removeBlockEffect = this.newBlock.addEffect(() => {\n      const listener = (blockNumber: number) => {\n        this.blockNumber = blockNumber\n        this.newBlock.emit(blockNumber)\n        this.emitUpdate()\n      }\n\n      provider.on('block', listener)\n\n      return () => {\n        provider.off('block', listener)\n      }\n    })\n\n    this.active = true\n    this.emitUpdate()\n  }\n\n  async deactivate() {\n    this.active = false\n    this.removeBlockEffect?.()\n    this.clearSubscriptions?.()\n    this._connectorUnsubscribe?.()\n    await this.connector.deactivate()\n    this.chainId = undefined\n    this.accounts = []\n    this.blockNumber = undefined\n    this.errors = []\n    this.emitUpdate()\n  }\n\n  async switchNetwork(chainId: number) {\n    const provider = this.getProvider()\n\n    validateArguments({ chainId }, { chainId: 'number' })\n\n    if (!provider) {\n      throw new Error('Connector not initialized')\n    }\n\n    try {\n      await provider.send('wallet_switchEthereumChain', [{ chainId: `0x${chainId.toString(16)}` }])\n    } catch (error: any) {\n      const errChainNotAddedYet = 4902 // Metamask error code\n      if (error.code === errChainNotAddedYet) {\n        const chain = (this._config.networks ?? DEFAULT_SUPPORTED_CHAINS).find((chain) => chain.chainId === chainId)\n        if (!chain)\n          throw new Error(\n            `ChainId \"${chainId}\" not found in config.networks. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`\n          )\n        if (!chain.rpcUrl)\n          throw new Error(\n            `ChainId \"${chainId}\" does not have RPC url configured by default. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`\n          )\n        await provider.send('wallet_addEthereumChain', [getAddNetworkParams(chain)])\n      } else {\n        throw error\n      }\n    }\n  }\n\n  reportError(error: Error) {\n    this.errors.push(error)\n    this.emitUpdate()\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}